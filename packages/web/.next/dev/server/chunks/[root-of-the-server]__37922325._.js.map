{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/Velocity-1/packages/web/lib/encrypt.ts"],"sourcesContent":["import crypto from \"crypto\";\n\nexport function encryptJson(plainJson: string) {\n  const key = crypto.randomBytes(32);\n  const iv = crypto.randomBytes(12);\n  const cipher = crypto.createCipheriv(\"aes-256-gcm\", key, iv);\n  const ciphertext = Buffer.concat([cipher.update(plainJson, \"utf8\"), cipher.final()]);\n  const authTag = cipher.getAuthTag();\n\n  const sealedKey = Buffer.from(\n    `${process.env.DEMO_SEALING_SECRET ?? \"demo-secret\"}:${key.toString(\"base64\")}`\n  ).toString(\"base64\");\n\n  return {\n    algorithm: \"aes-256-gcm\",\n    iv: iv.toString(\"base64\"),\n    authTag: authTag.toString(\"base64\"),\n    ciphertext: ciphertext.toString(\"base64\"),\n    sealedKey\n  };\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,YAAY,SAAiB;IAC3C,MAAM,MAAM,gHAAM,CAAC,WAAW,CAAC;IAC/B,MAAM,KAAK,gHAAM,CAAC,WAAW,CAAC;IAC9B,MAAM,SAAS,gHAAM,CAAC,cAAc,CAAC,eAAe,KAAK;IACzD,MAAM,aAAa,OAAO,MAAM,CAAC;QAAC,OAAO,MAAM,CAAC,WAAW;QAAS,OAAO,KAAK;KAAG;IACnF,MAAM,UAAU,OAAO,UAAU;IAEjC,MAAM,YAAY,OAAO,IAAI,CAC3B,GAAG,QAAQ,GAAG,CAAC,mBAAmB,IAAI,cAAc,CAAC,EAAE,IAAI,QAAQ,CAAC,WAAW,EAC/E,QAAQ,CAAC;IAEX,OAAO;QACL,WAAW;QACX,IAAI,GAAG,QAAQ,CAAC;QAChB,SAAS,QAAQ,QAAQ,CAAC;QAC1B,YAAY,WAAW,QAAQ,CAAC;QAChC;IACF;AACF"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/Velocity-1/packages/web/lib/inftAbi.ts"],"sourcesContent":["export const HUMAN_AGENT_INFT_ABI = [\n  \"event Minted(uint256 indexed tokenId, address indexed owner, string encryptedURI, bytes32 metadataHash)\",\n  \"function mint(address to, string encryptedURI, bytes32 metadataHash) returns (uint256)\",\n  \"function ownerToTokenId(address owner) view returns (uint256)\",\n  \"function getEncryptedURI(uint256 tokenId) view returns (string)\",\n  \"function getMetadataHash(uint256 tokenId) view returns (bytes32)\",\n  \"function authorizeUsage(uint256 tokenId, address executor, bool allowed)\",\n  \"function isVerified(address wallet) view returns (bool)\"\n] as const;\n\nexport const FAUCET_ABI = [\n  \"function claim(address caller, address recipient)\",\n  \"function cooldownRemaining(address wallet) view returns (uint256)\"\n] as const;\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,uBAAuB;IAClC;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,aAAa;IACxB;IACA;CACD"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/Velocity-1/packages/web/lib/ogStorage.ts"],"sourcesContent":["import crypto from \"crypto\";\n\nexport async function storeEncryptedMetadata(data: string): Promise<string> {\n  try {\n    const sdk = (await import(\"@0glabs/0g-ts-sdk\")) as Record<string, unknown>;\n    const createStorageClient = sdk.createStorageClient as\n      | ((args: { url: string; apiKey?: string }) => Promise<{ store: (payload: string) => Promise<{ uri?: string; rootHash?: string }> }>)\n      | undefined;\n    if (!createStorageClient || !process.env.OG_STORAGE_URL) {\n      throw new Error(\"0G storage client unavailable\");\n    }\n    const client = await createStorageClient({\n      url: process.env.OG_STORAGE_URL,\n      apiKey: process.env.OG_STORAGE_API_KEY\n    });\n    const result = await client.store(data);\n    return result.uri ?? `0g://${result.rootHash ?? \"unknown\"}`;\n  } catch {\n    const digest = crypto.createHash(\"sha256\").update(data).digest(\"hex\");\n    return `demo://encrypted/${digest}`;\n  }\n}\n\nexport async function retrieveEncryptedMetadata(uri: string): Promise<string> {\n  return `Retrieve stub for ${uri}`;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,uBAAuB,IAAY;IACvD,IAAI;QACF,MAAM,MAAO;QACb,MAAM,sBAAsB,IAAI,mBAAmB;QAGnD,IAAI,CAAC,uBAAuB,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YACvD,MAAM,IAAI,MAAM;QAClB;QACA,MAAM,SAAS,MAAM,oBAAoB;YACvC,KAAK,QAAQ,GAAG,CAAC,cAAc;YAC/B,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;QACxC;QACA,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC;QAClC,OAAO,OAAO,GAAG,IAAI,CAAC,KAAK,EAAE,OAAO,QAAQ,IAAI,WAAW;IAC7D,EAAE,OAAM;QACN,MAAM,SAAS,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,MAAM,MAAM,CAAC;QAC/D,OAAO,CAAC,iBAAiB,EAAE,QAAQ;IACrC;AACF;AAEO,eAAe,0BAA0B,GAAW;IACzD,OAAO,CAAC,kBAAkB,EAAE,KAAK;AACnC"}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/Velocity-1/packages/web/app/api/mint/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { Contract, JsonRpcProvider, Wallet, ethers } from \"ethers\";\n\nimport { encryptJson } from \"@/lib/encrypt\";\nimport { HUMAN_AGENT_INFT_ABI } from \"@/lib/inftAbi\";\nimport { storeEncryptedMetadata } from \"@/lib/ogStorage\";\n\nexport const runtime = \"nodejs\";\n\nconst lastByIp = new Map<string, number>();\nconst MIN_MS = 15_000;\n\nfunction isAddress(value: string): boolean {\n  return /^0x[a-fA-F0-9]{40}$/.test(value);\n}\n\nexport async function POST(req: Request) {\n  try {\n    const ip = req.headers.get(\"x-forwarded-for\") ?? \"local\";\n    const now = Date.now();\n    const last = lastByIp.get(ip) ?? 0;\n    if (now - last < MIN_MS) {\n      return NextResponse.json({ ok: false, error: \"Rate limit: wait a few seconds.\" }, { status: 429 });\n    }\n    lastByIp.set(ip, now);\n\n    const { to_address, verificationPassed } = await req.json();\n    if (verificationPassed !== true) {\n      return NextResponse.json({ ok: false, error: \"Verification required.\" }, { status: 403 });\n    }\n    if (!isAddress(to_address)) {\n      return NextResponse.json({ ok: false, error: \"Invalid wallet address.\" }, { status: 400 });\n    }\n\n    const rpcUrl = process.env.OG_RPC_URL ?? \"https://evmrpc-testnet.0g.ai\";\n    const pk = process.env.PRIVATE_KEY ?? \"\";\n    const inftAddress = process.env.NEXT_PUBLIC_INFT_ADDRESS ?? \"\";\n    if (!pk.startsWith(\"0x\") || !isAddress(inftAddress)) {\n      return NextResponse.json({ ok: false, error: \"Missing deployment env vars.\" }, { status: 500 });\n    }\n\n    const metadata = {\n      type: \"human-agent\",\n      issuer: \"0G Trust Studio\",\n      verified: true,\n      verifiedAt: now,\n      expiresAt: now + 30 * 24 * 60 * 60 * 1000,\n      policy: { cooldownSec: 86400 },\n      model: { name: \"demo-classifier\" }\n    };\n    const plaintext = JSON.stringify(metadata);\n    const encryptedPayload = JSON.stringify(encryptJson(plaintext));\n    const encryptedURI = await storeEncryptedMetadata(encryptedPayload);\n    const metadataHash = ethers.keccak256(ethers.toUtf8Bytes(plaintext));\n\n    const provider = new JsonRpcProvider(rpcUrl);\n    const signer = new Wallet(pk, provider);\n    const inft = new Contract(inftAddress, HUMAN_AGENT_INFT_ABI, signer);\n    const tx = await inft.mint(to_address, encryptedURI, metadataHash, { gasLimit: 500_000 });\n    const receipt = await tx.wait();\n    const parsed = receipt?.logs\n      .map((log: { topics: readonly string[]; data: string }) => {\n        try {\n          return inft.interface.parseLog(log);\n        } catch {\n          return null;\n        }\n      })\n      .find((v: { name: string; args: { tokenId: bigint } } | null) => v?.name === \"Minted\");\n    const tokenId = parsed?.args?.tokenId?.toString() ?? null;\n\n    return NextResponse.json({\n      ok: true,\n      tokenId,\n      txHash: receipt?.hash,\n      encryptedURI,\n      metadataHash\n    });\n  } catch (error: unknown) {\n    const message = error instanceof Error ? error.message : String(error);\n    return NextResponse.json({ ok: false, error: message }, { status: 400 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;AAEO,MAAM,UAAU;AAEvB,MAAM,WAAW,IAAI;AACrB,MAAM,SAAS;AAEf,SAAS,UAAU,KAAa;IAC9B,OAAO,sBAAsB,IAAI,CAAC;AACpC;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,KAAK,IAAI,OAAO,CAAC,GAAG,CAAC,sBAAsB;QACjD,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,OAAO,SAAS,GAAG,CAAC,OAAO;QACjC,IAAI,MAAM,OAAO,QAAQ;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QAClG;QACA,SAAS,GAAG,CAAC,IAAI;QAEjB,MAAM,EAAE,UAAU,EAAE,kBAAkB,EAAE,GAAG,MAAM,IAAI,IAAI;QACzD,IAAI,uBAAuB,MAAM;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QACzF;QACA,IAAI,CAAC,UAAU,aAAa;YAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;QACzC,MAAM,KAAK,QAAQ,GAAG,CAAC,WAAW,IAAI;QACtC,MAAM,cAAc,kFAAwC;QAC5D,IAAI,CAAC,GAAG,UAAU,CAAC,SAAS,CAAC,UAAU,cAAc;YACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,MAAM,WAAW;YACf,MAAM;YACN,QAAQ;YACR,UAAU;YACV,YAAY;YACZ,WAAW,MAAM,KAAK,KAAK,KAAK,KAAK;YACrC,QAAQ;gBAAE,aAAa;YAAM;YAC7B,OAAO;gBAAE,MAAM;YAAkB;QACnC;QACA,MAAM,YAAY,KAAK,SAAS,CAAC;QACjC,MAAM,mBAAmB,KAAK,SAAS,CAAC,IAAA,kJAAW,EAAC;QACpD,MAAM,eAAe,MAAM,IAAA,+JAAsB,EAAC;QAClD,MAAM,eAAe,+MAAM,CAAC,SAAS,CAAC,+MAAM,CAAC,WAAW,CAAC;QAEzD,MAAM,WAAW,IAAI,gNAAe,CAAC;QACrC,MAAM,SAAS,IAAI,uLAAM,CAAC,IAAI;QAC9B,MAAM,OAAO,IAAI,6LAAQ,CAAC,aAAa,2JAAoB,EAAE;QAC7D,MAAM,KAAK,MAAM,KAAK,IAAI,CAAC,YAAY,cAAc,cAAc;YAAE,UAAU;QAAQ;QACvF,MAAM,UAAU,MAAM,GAAG,IAAI;QAC7B,MAAM,SAAS,SAAS,KACrB,IAAI,CAAC;YACJ,IAAI;gBACF,OAAO,KAAK,SAAS,CAAC,QAAQ,CAAC;YACjC,EAAE,OAAM;gBACN,OAAO;YACT;QACF,GACC,KAAK,CAAC,IAA0D,GAAG,SAAS;QAC/E,MAAM,UAAU,QAAQ,MAAM,SAAS,cAAc;QAErD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ;YACA,QAAQ,SAAS;YACjB;YACA;QACF;IACF,EAAE,OAAO,OAAgB;QACvB,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAChE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IACxE;AACF"}}]
}